<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FF8C00">
    <title>Basketball Shot Counter</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèÄ</text></svg>">
    <link rel="manifest" href="manifest.json" onerror="this.remove()">
    <link rel="stylesheet" href="styles.css">
    <link rel="apple-touch-icon" href="icon-192.png" onerror="this.remove()">
    
    <!-- Firebase SDKs (only loads if not file:// protocol) -->
    <script>
        if (window.location.protocol !== 'file:') {
            // Load Firebase App first
            const script1 = document.createElement('script');
            script1.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js';
            
            script1.onload = () => {
                // Once Firebase App is loaded, load Firestore
                const script2 = document.createElement('script');
                script2.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js';
                
                script2.onload = () => {
                    // Once both are loaded, load the config
                    const configScript = document.createElement('script');
                    configScript.src = 'firebase-config.js';
                    document.head.appendChild(configScript);
                };
                document.head.appendChild(script2);
            };
            document.head.appendChild(script1);
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div id="syncStatus" class="sync-status-top-left"></div>
            <h1>üèÄ Basketball Shot Counter</h1>
            <div id="gameNameDisplay" class="game-name-header"></div>
            <button id="teamSwitchBtn" class="team-switch-btn">Home Team</button>
        </header>

        <!-- Court View Toggle -->
        <div class="view-toggle">
            <button id="courtViewBtn" class="view-btn active">Court View</button>
            <button id="playersViewBtn" class="view-btn">Players</button>
            <button id="foulsViewBtn" class="view-btn">Fouls</button>
            <div class="period-selector" style="display: flex; align-items: center; gap: 8px; margin-left: auto;">
                <span style="color: white; font-weight: 600; font-size: 14px;">Period:</span>
                <button class="period-btn" data-period="1" id="period1Btn">1</button>
                <button class="period-btn" data-period="2" id="period2Btn">2</button>
                <button class="period-btn" data-period="3" id="period3Btn">3</button>
                <button class="period-btn" data-period="4" id="period4Btn">4</button>
            </div>
        </div>

        <!-- Court View -->
        <div id="courtView" class="court-container">
            <div class="court-wrapper">
                <svg id="basketballCourt" class="basketball-court" viewBox="0 0 500 320" xmlns="http://www.w3.org/2000/svg">
                    <!-- Court Background (Half Court) -->
                    <rect x="0" y="0" width="500" height="470" fill="#FF8C42" class="court-floor"/>
                    
                    <!-- Court Boundary Lines -->
                    <!-- Baseline (top - inverted) -->
                    <line x1="0" y1="0" x2="500" y2="0" stroke="#8B4513" stroke-width="4"/>
                    <!-- Sidelines (left and right) -->
                    <line x1="0" y1="0" x2="0" y2="470" stroke="#8B4513" stroke-width="4"/>
                    <line x1="500" y1="0" x2="500" y2="470" stroke="#8B4513" stroke-width="4"/>
                    <!-- Midcourt Line (bottom - inverted) -->
                    <line x1="0" y1="470" x2="500" y2="470" stroke="#8B4513" stroke-width="4"/>
                    
                    <!-- Center Line (horizontal line in middle of court) -->
                    <line x1="0" y1="300" x2="500" y2="300" stroke="#8B4513" stroke-width="2"/>
                    
                    <!-- Center Circle (partial, at bottom - inverted) -->
                    <path d="M 190 470 A 60 60 0 0 0 250 470" fill="none" stroke="#8B4513" stroke-width="3"/>
                    
                    <!-- Key/Paint Area (narrower rectangle from baseline) -->
                    <!-- Key extends from baseline downward (inverted) -->
                    <rect x="200" y="0" width="100" height="120" fill="#FFA366" stroke="#8B4513" stroke-width="3"/>
                    
                    <!-- Free Throw Line (horizontal line at bottom of key - inverted) -->
                    <line x1="200" y1="120" x2="300" y2="120" stroke="#8B4513" stroke-width="3"/>
                    
                    <!-- Free Throw Circle (solid semicircle below free throw line, extending outward - inverted) -->
                    <path d="M 200 120 A 60 60 0 0 0 300 120" fill="none" stroke="#8B4513" stroke-width="3"/>
                    
                    <!-- Lane Marks / Block Marks (hash marks on sides of key) -->
                    <!-- Top hash marks (inverted) -->
                    <line x1="200" y1="20" x2="210" y2="20" stroke="#8B4513" stroke-width="2"/>
                    <line x1="290" y1="20" x2="300" y2="20" stroke="#8B4513" stroke-width="2"/>
                    <!-- Middle hash marks (inverted) -->
                    <line x1="200" y1="60" x2="210" y2="60" stroke="#8B4513" stroke-width="2"/>
                    <line x1="290" y1="60" x2="300" y2="60" stroke="#8B4513" stroke-width="2"/>
                    <!-- Bottom hash marks (inverted) -->
                    <line x1="200" y1="100" x2="210" y2="100" stroke="#8B4513" stroke-width="2"/>
                    <line x1="290" y1="100" x2="300" y2="100" stroke="#8B4513" stroke-width="2"/>
                    
                    <!-- Basket/Hoop Area (small semicircle inside key, near baseline - inverted) -->
                    <path d="M 235 20 A 25 25 0 0 0 265 20" 
                          fill="#FFB380" stroke="#8B4513" stroke-width="2"/>
                    
                    <!-- Three-Point Line -->
                    <!-- Wide, shallow arc - single continuous curve from middle of baseline (inverted) -->
                    <path d="M 50 0 C 100 270, 400 270, 450 0" 
                          fill="none" stroke="#8B4513" stroke-width="3" 
                          stroke-linecap="round"/>
                    
                    <!-- Shot Markers will be dynamically added here -->
                </svg>
                
                <!-- Player Selection Overlay -->
                <div id="playerSelectOverlay" class="player-select-overlay" style="display: none;">
                    <div class="player-select-content">
                        <h3>Select Player</h3>
                        <div id="playerSelectList" class="player-select-list">
                            <!-- Players will be added here -->
                        </div>
                        <button class="btn btn-secondary" onclick="app.closePlayerSelect(true)">Cancel</button>
                    </div>
                </div>
            </div>
            
            <div class="court-controls">
                <button id="clearCourtBtn" class="btn btn-secondary">Clear All Shots</button>
                <button id="viewStatsBtn" class="btn btn-primary">View All Stats</button>
            </div>
        </div>

        <!-- Players View -->
        <div id="playersView" style="display: none;">
            <div class="add-player-section">
                <h2>Add Player</h2>
                <div class="add-player-inputs">
                    <input type="text" id="playerNameInput" class="add-player-input" placeholder="Name" maxlength="30">
                    <input type="number" id="playerNumberInput" class="add-player-input" placeholder="Number" min="0" max="99">
                    <button id="addPlayerBtn" class="btn btn-primary">Add</button>
                </div>
            </div>

            <div class="players-list" id="playersList">
                <!-- Player cards will be dynamically added here -->
            </div>

            <div class="empty-state" id="emptyState">
                <p>üë§ No players added yet.</p>
                <p>Add a player number above to start tracking!</p>
            </div>
        </div>

        <!-- Fouls View -->
        <div id="foulsView" style="display: none;">
            <div class="players-list" id="foulsList">
                <!-- Player foul cards will be dynamically added here -->
            </div>

            <div class="empty-state" id="foulsEmptyState">
                <p>üë§ No players added yet.</p>
                <p>Add players in the Players tab to track fouls!</p>
            </div>
        </div>
    </div>

    <!-- Shot Details Modal -->
    <div class="modal" id="shotDetailsModal">
        <div class="modal-content">
            <span class="close" id="closeShotDetailsModal">&times;</span>
            <h2>Shot Details</h2>
            <div class="modal-body">
                <div class="player-name-modal" id="shotDetailsPlayerNumber"></div>
                <div class="shot-details-info" id="shotDetailsInfo">
                    <!-- Shot info will be displayed here -->
                </div>
                <button id="deleteShotBtn" class="btn btn-danger" style="width: 100%; margin-top: 20px;">Delete Shot</button>
            </div>
        </div>
    </div>

    <!-- Shot Tracking Modal -->
    <div class="modal" id="shotModal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <h2 id="modalTitle">Record Shot</h2>
            <div class="modal-body">
                <div class="player-name-modal" id="modalPlayerNumber"></div>
                
                <div class="shot-controls">
                    <div class="shot-result-section">
                        <h3>Shot Result</h3>
                        <div class="shot-result-buttons">
                            <button class="shot-result-btn shot-made" data-result="made">‚úÖ Made</button>
                            <button class="shot-result-btn shot-missed" data-result="missed">‚ùå Missed</button>
                        </div>
                    </div>

                    <div class="shot-type-display" id="shotTypeDisplay" style="background: var(--bg-color); border-radius: 12px; padding: 15px; margin-top: 10px; text-align: center;">
                        <span style="font-size: 18px; font-weight: 600; color: var(--text-primary);" id="detectedShotType">2-Point Shot</span>
                    </div>

                    <div class="summary-display" id="summaryDisplay">
                        <div class="summary-stats" id="summaryStats">
                            <!-- Stats will be displayed here -->
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    
    <!-- Player Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <span class="close" id="closeStatsModal">&times;</span>
            <h2 id="statsModalTitle">Player Statistics</h2>
            <div class="modal-body">
                <div class="player-name-modal" id="statsModalPlayerNumber"></div>
                <div class="stats-display" id="statsDisplay">
                    <!-- Detailed stats will be displayed here -->
                </div>
                <button id="deletePlayerBtn" class="btn btn-danger" style="margin-top: 20px;">Delete Player</button>
            </div>
        </div>
    </div>

    <!-- All Players Stats Modal -->
    <div class="modal" id="allStatsModal">
        <div class="modal-content" style="max-height: 90vh;">
            <span class="close" id="closeAllStatsModal">&times;</span>
            <h2>All Players Statistics</h2>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <button id="exportStatsBtn" class="btn btn-primary" style="width: 100%;">Export Report</button>
                </div>
                <div class="all-stats-display" id="allStatsDisplay">
                    <!-- All players stats will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Game Sync Modal -->
    <div class="modal" id="gameModal">
        <div class="modal-content">
            <span class="close" id="closeGameModal">&times;</span>
            <h2>Game Sync</h2>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <label for="gameNameInput" style="display: block; font-size: 14px; margin-bottom: 10px; color: #2C3E50; font-weight: 600;">Game Name:</label>
                    <input type="text" id="gameNameInput" placeholder="e.g., Quitman vs Mineola" maxlength="50" style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                    <button id="saveGameNameBtn" class="btn btn-primary" style="width: 100%; margin-top: 10px; padding: 10px;">Save Game Name</button>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                    <p style="font-size: 14px; color: #7F8C8D; margin-bottom: 15px;">Share this Game Code with other devices to sync data</p>
                    <div class="game-id-display">
                        <input type="text" id="gameIdDisplay" readonly value="" style="flex: 1; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 18px; font-family: monospace; background: #F5F7FA; text-align: center; letter-spacing: 4px; font-weight: bold;">
                        <button id="copyGameIdBtn" class="btn btn-primary" style="padding: 10px 20px; margin-left: 10px;">Copy</button>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                    <button id="createNewGameBtn" class="btn btn-secondary" style="width: 100%; padding: 12px; margin-bottom: 10px;">üÜï Create New Game</button>
                    <p style="font-size: 12px; color: #7F8C8D; text-align: center; margin: 0;">This will generate a new game code and clear current data</p>
                </div>
                
                <div class="game-id-input" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                    <label for="gameIdInput" style="display: block; font-size: 14px; margin-bottom: 10px; color: #2C3E50; font-weight: 600;">Connect to existing game:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="gameIdInput" placeholder="Enter 6-digit code" maxlength="6" style="flex: 1; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 18px; text-align: center; font-family: monospace; letter-spacing: 4px; font-weight: bold;">
                        <button id="setGameIdBtn" class="btn btn-secondary" style="padding: 10px 20px;">Connect</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Sync Button (Fixed at bottom) -->
    <button id="openGameModalBtn" class="game-sync-button" title="Game Sync Settings">üîó</button>

    <script src="script.js"></script>
</body>
</html>
